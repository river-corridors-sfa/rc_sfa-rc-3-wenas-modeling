---
title: "03_Wenas_meta_stats"
output: html_document
date: "2023-07-11"
editor_options: 
  chunk_output_type: console
---

## Load packages and set working directory
```{r Jake/Mac}
#for Jake/mac

rm(list=ls(all=T)) #this clears your Environment


library(tidyverse)
library(rstatix)
library(ggpubr)
library(ggplot2)
library(coin)

```


### STEP 1 load in the data and normalize data ###
```{r Metadata Google Sheet Import}
#import Metadata sheet that is stored on Google Sheet 
percent_difference <- read_csv("~/GitHub/rc_sfa-rc-3-wenas-modeling/Lit_Review_Fig/Output_for_analysis/analyte_table_DOC_no3.csv")

# log transform the percentages 
percent_difference <- percent_difference %>% 
  mutate(log_pd = log(abs(Percent_Difference))) # should I be taking the absolute value of the negative percent_differences?

percent_difference_DOC <- percent_difference %>% 
  filter(response_var == "DOC_mg_C_L")

percent_difference_NO3 <- percent_difference %>% 
  filter(response_var == "NO3_mg_per_L_as_Nitrate")

```

### STEP 2 check normality for DOC ###
```{r DOC}
summary(percent_difference_DOC$Percent_Difference)

#Visualize data
ggboxplot(percent_difference_DOC$Percent_Difference, 
          ylab = "Percent Difference (%)", xlab = FALSE,
          ggtheme = theme_minimal())


#perform shapiro-wilk test
shapiro.test(percent_difference_DOC$Percent_Difference)

# checking to see if the data is normal 
ggqqplot(percent_difference_DOC$Percent_Difference, ylab = "Percent Difference",
         ggtheme = theme_minimal())

# p-value is greater than 0.05 which indicates that the data is normally distributed

```

The percent differences for DOC are already normally distributed and do NOT need to be transformed. 

### STEP 3 perform t-test for DOC ###
```{r one-sample t-test}
# 
res <- t.test(percent_difference_DOC$Percent_Difference, mu = 0)
# printing the results
res

```
t is the test-statistic value (t=4.0412)
df is the degrees of freedom (df = 30)
p-value is the significance level of the t-test (p-value = 0.0003409)
conf.int is the confidence interval of the mean at 95% ([17.14,52.16])
sample estimates is the mean value of the sample (mean = 34.65)

The p-value of the test is 0.0003409, which is less than the significance level alpha = 0.05. We can conclude that the mean percent difference for DOC is significantly different from 0%. 

### STEP 4 do the same thing for nitrate  ###

```{r NO3}
###  check normality for NO3 ###
summary(percent_difference_NO3$Percent_Difference)

#Visualize data
ggboxplot(percent_difference_NO3$Percent_Difference, 
          ylab = "Percent Difference (%)", xlab = FALSE,
          ggtheme = theme_minimal())


#perform shapiro-wilk test
shapiro.test(percent_difference_NO3$Percent_Difference)

# p-value is less than 0.05 which indicates that the data is normally distributed


# checking to see if the data is normal 
ggqqplot(percent_difference_NO3$Percent_Difference, ylab = "Percent Difference",
         ggtheme = theme_minimal())
```

The percent differences for nitrate do not appear to be normally distributed so lets do a log transform 

```{r log transform for NO3}
#perform shapiro-wilk test
shapiro.test(percent_difference_NO3$log_pd)

# p-value is less than 0.05 which indicates that the data is normally distributed


# checking to see if the data is normal 
ggqqplot(percent_difference_NO3$log_pd, ylab = "Percent Difference",
         ggtheme = theme_minimal())
```
I don't think this looks better than the non-log transformed. What should we go with here?


```{r one-sample t-test}
# 
res <- t.test(percent_difference_NO3$Percent_Difference, mu = 0)
# printing the results
res

```
t is the test-statistic value (t = 6.5941)
df is the degrees of freedom (df = 47)
p-value is the significance level of the t-test (p-value = 3.378e-08)
conf.int is the confidence interval of the mean at 95% ([124.93,234.63])
sample estimates is the mean value of the sample (mean = 179.7861)

The p-value of the test is 3.378e, which is less than the significance level alpha = 0.05. We can conclude that the mean percent difference for NO3 is significantly different from 0%. 





























